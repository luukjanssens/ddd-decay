<!DOCTYPE html>
<html lang="en">
	<head>
		<title>flocsdsking</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #ffffff;
				margin: 0px;
				overflow: hidden;
				font-family: sans-serif;
			}

			a {
				color:#0078ff;
			}

			#info {
				color: #000;
				position: absolute;
				top: 10px;
				width: 100%;
			}

			#container {
				position: relative;
				max-width: 90%;
				z-index: 10;
				background: red;
				opacity: 1;
			}

			.text {
				z-index: 0;
				font-size: 2em;
				color: black;
				position: absolute;
				opacity: 1;
				right: 20vw;
				top: 15vw;
				max-width: 400px;
			}
		</style>
	</head>
	<body>



		<div id="container"></div>

		<script src="js/three.min.js"></script>
		<script id="vertexShader" type="x-shader/x-vertex">
			void main() {
				gl_Position = vec4( position, 1.0 );
			}
		</script>

		<script id="fragmentShader" type="x-shader/x-fragment">
			uniform vec2 u_resolution;
			uniform float u_time;
			uniform sampler2D u_texture_1;
			uniform sampler2D u_texture_2;
			uniform float u_days;
			uniform vec2 st;
			uniform vec2 u_fragcoord;

			void main() {
				float amplitude = 100.;
				float frequency = 5.0;

				float new_s = gl_FragCoord.s * -1.0 + 0.5;
				float new_t = gl_FragCoord.t * -1.0 + 0.5;
				vec2 new_coord = vec2(new_s, new_s);

				vec2 st = gl_FragCoord.st/u_resolution.xy;

				// colors:
				// blue					0.049, 0.055, 0.352
				// purple 			0.179, 0.013, 0.333
				// red 					0.918, 0.202, 0.165
				// light-gray		0.784, 0.788, 0.796

				vec3 pattern_1 = vec3(0.6);
				vec3 pattern_2 = vec3(0.6);

				vec4 texture_1 = texture2D(u_texture_1, st);
				vec4 texture_2 = texture2D(u_texture_2, st);


				pattern_1 += texture_1.xyz;
				pattern_2 += texture_2.xyz;

				vec3 print = vec3(0.6);
				vec3 layer_1 = abs(pattern_1 - pattern_2);

					if(all(greaterThan(layer_1, vec3(0.15)))) {
						layer_1 = vec3(0.6);
					} else {
						layer_1 = vec3(0.08);
					}
					print = layer_1;

				vec4 texture = vec4(print, 1.0);
				gl_FragColor = texture;
			}
		</script>

    <script>
				let container;
				let canvas;
        let camera, scene, renderer;
				let uniforms;
				let textSize = new THREE.Vector2();
				let days = 1.0;
				let shortLoop_1 = 0.0;
				let shortLoop_2 = 0.0;

				let clock_1 = new THREE.Clock();
				let clock_2 = new THREE.Clock();
				clock_2.autoStart = false;
				let date = Date.now();

        init();
				animate();


        function init() {
					renderer = new THREE.WebGLRenderer();
					renderer.setClearColor(1.0, 1.0, 1.0, 0.0);
					renderer.setPixelRatio( window.devicePixelRatio );

					container = document.getElementById( 'container' );
					container.appendChild( renderer.domElement );

          camera = new THREE.Camera();
          camera.position.z = 1;

					scene = new THREE.Scene();

          const geometry = new THREE.PlaneBufferGeometry( 2, 2 );

					const loader = new THREE.TextureLoader();

					const texture1 = loader.load( './img/bear_1.jpg' );
					const texture2 = loader.load( './img/bear_2.jpg' );

          uniforms = {
						u_time: { type: "f", value: 1.0 },
						u_days: { type: "f", value: 1.0 },
						u_resolution: { type: "v2", value: new THREE.Vector2() },
						u_texture_1: { type: "t", value: texture1 },
						u_texture_2: { type: "t", value: texture2 },
						u_fragcoord: { type: "v2", value: new THREE.Vector2() }
					};

          const material = new THREE.ShaderMaterial({
						uniforms: uniforms,
						vertexShader: document.getElementById( 'vertexShader' ).textContent,
						fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
						transparent: true,
						opacity: 0,
					});

					const mesh = new THREE.Mesh(geometry, material);

					scene.add(mesh);

				  onWindowResize();
					window.addEventListener('resize', onWindowResize, false);
				}

				const textCanvas = document.createElement('canvas');
				loadSVG('img/text.svg',canvas);

				function loadSVG(file,canvas){
					var svg=new Image();
					svg.addEventListener('load',function(){
						var ctx=textCanvas.getContext('2d');
						textCanvas.width=svg.width;
						textCanvas.height=svg.height;
						ctx.drawImage(svg,0,0);
					})
					svg.src=file;
				}

        function onWindowResize(event) {
					renderer.setSize(window.innerWidth, window.innerHeight);
					uniforms.u_resolution.value.x = renderer.domElement.width;
					uniforms.u_resolution.value.y = renderer.domElement.height;
        }

        function animate() {
					requestAnimationFrame(animate);
					render();
				}

        function render() {
					// uniforms.u_time.value += 0.05;
					//days += (0 - days)*0.05;
					days += 1.0;

					console.log(days)
					const shortVelocity = 0.09;
					const shortLoopTime_1 = clock_1.getElapsedTime();
					const shortLoopTime_2 = clock_2.getElapsedTime();

					shortLoop_1_curve = Math.sin(shortLoopTime_1 * shortVelocity);
					shortLoop_2_curve = Math.sin(shortLoopTime_2 * shortVelocity);

					shortLoop_1 = Math.abs(shortLoop_1_curve, 0);
					shortLoop_2 = Math.abs(shortLoop_2_curve, 0);

					if(clock_1.running && shortLoop_1 > 0.99) {
						clock_1.stop();
						clock_2.start();
						console.log('start 2')
					}
					if(clock_2.running && shortLoop_2 > 0.99) {
						clock_2.stop();
						clock_1.start();
						console.log('start 1')
					}

					renderer.render( scene, camera );
        }
    </script>
	</body>
</html>
