<!--
            .:+osssso+/:`                    `-/+osssso+/-                     .:+ossssoo/:.
        -odNmys+////+oshNNh+`            `/ymNdyo+////+oydNds:             .ohNmhs+/////oshmNh+.
      /dMy/`             .+dMy-        `sNmo-             `:sNmo`        :dMh/`             .+dMh-
    .dMy.  :hhhhhhhhys+-    :dMs      /NN/   shhhhhhhyyo/.   `oNm-     `hMh.  -hhhhhhhhys+:`   -hMy`
  .NM/    /MM/:::://ohMNs.   yMh    oMd`    mMh:::::/+smMm/   -NM:   `mM+    :MM+:::://ohNMy.   oMd`
  hM+     /MM`        `yMN-   dM+  -MN`     mMs         :mMh   -MN`  yMs     :MM.        `sMM/   yMs
.MN      /MM`          dMm   :Md  sMo      mMs          -MM+   hM/ `MM`     :MM.          yMN`  .MN
:Md      /MM`          oMM`  .MN  hM/      mMs           NMs   sMo .MN      :MM.          +MM.  `MM`
-MN      /MM`          dMd   :Mm  yMo      mMs          -MM/   hM+ `MM`     :MM.          yMN   .MN
 mM/     /MM`        `yMN-   yMo  :Mm`     mMs         :NMy   .MN`  hM+     :MM.        `sMN:   sMy
 -NN-    /MM::::::/ohMNs`   +Md`   yMy     mMh::::::/smMd/   `dM+   .NM:    :MM/:::::/+yNMy.   /Mm`
 -mN+   :hhhhhhhhhyo:    .yMh`     sMd-   yhhhhhhhhys/.    :mN/     .mMo`  -hhhhhhhhhyo:`   `sMd.
  `oNmo.               :yMm/        -hMh/`              `+dMy.        +NNs-               -sNm+
    `/yNNho/:-..--:+sdNms-            .odMds+/--..-:/oymNh+`            :yNNho/:--.--:+shNmy:
        ./+syhhhhhys+:`                  `-/oyhhhhhyso/-                   .:+syhhhhhys+:`
-->
<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- COMMON TAGS -->
		<meta charset="utf-8">
		<title>ⒹⒹⒹ an event by Bakken & Bæck</title>
		<!-- Search Engine -->
		<meta name="description" content="ⒹⒹⒹ is a quarterly event, in which we invite one developer, one designer and one thinker to reflect on a specific theme. For the third edition on January 23rd, we'll focus on the theme of “Digital Decay”.">
		<meta name="image" content="https://bakkenbaeck.com/images/ddd-share-decay.png">
		<!-- Schema.org for Google -->
		<meta itemprop="name" content="ⒹⒹⒹ an event by Bakken & Bæck">
		<meta itemprop="description" content="ⒹⒹⒹ is a quarterly event, in which we invite one developer, one designer and one thinker to reflect on a specific theme. For the third edition on January 23rd, we'll focus on the theme of “Digital Decay”.">
		<meta itemprop="image" content="https://bakkenbaeck.com/images/ddd-share-decay.png">
		<!-- Twitter -->
		<meta name="twitter:card" content="summary">
		<meta name="twitter:title" content="ⒹⒹⒹ an event by Bakken & Bæck">
		<meta name="twitter:description" content="ⒹⒹⒹ is a quarterly event, in which we invite one developer, one designer and one thinker to reflect on a specific theme. For the third edition on January 23rd, we'll focus on the theme of “Digital Decay”.">
		<meta name="twitter:site" content="@bakkenbaeck">
		<meta name="twitter:creator" content="@bakkenbaeck">
		<meta name="twitter:image:src" content="https://bakkenbaeck.com/images/ddd-share-decay.png?43629843">
		<!-- Open Graph general (Facebook, Pinterest & Google+) -->
		<meta name="og:title" content="ⒹⒹⒹ an event by Bakken & Bæck">
		<meta name="og:description" content="ⒹⒹⒹ is a quarterly event, in which we invite one developer, one designer and one thinker to reflect on a specific theme. For the third edition on January 23rd, we'll focus on the theme of “Digital Decay”.">
		<meta name="og:image" content="https://bakkenbaeck.com/images/ddd-share-decay.png">
		<meta name="og:url" content="https://bakkenbaeck.com/ddd">
		<meta name="og:site_name" content="ⒹⒹⒹ an event by Bakken & Bæck">
		<meta name="og:type" content="website">

		<link rel="shortcut icon" href="./favicon.ico" type="image/x-icon">
		<link rel="icon" href="./favicon.ico" type="image/x-icon">
		<style>
			html, body {
				margin: 0;
				height: 100%;
				overflow: hidden;
				background-color: #141414;
			}

			#container {
				-webkit-transition: opacity 2s ease-in-out;
				-moz-transition: opactiy 2s ease-in-out;
				-ms-transition: opacity 2s ease-in-out;
				-o-transition: opacity 2s ease-in-out;
				transition: opacity 2s ease-in-out;
			}

			.hide {
				opacity: 0;
			}
		</style>
	</head>
	<body>

		<div id="container" class="hide"></div>
		<canvas id="layer1"></canvas>
		<canvas id="layer2"></canvas>
		<canvas id="layer3"></canvas>

		<script src="js/three.min.js"></script>
		<script id="vertexShader" type="x-shader/x-vertex">
			void main() {
				gl_Position = vec4( position, 1.0 );
			}
		</script>

		<script id="fragmentShader" type="x-shader/x-fragment">
			uniform vec2 u_resolution;
			uniform sampler2D u_texture_1;
			uniform sampler2D u_texture_2;
			uniform sampler2D u_texture_3;
			uniform sampler2D u_texture_4;
			uniform sampler2D u_texture_5;
			uniform float u_loop_1;
			uniform float u_loop_2;
			uniform float u_layer_1_curve;
			uniform float u_layer_2_curve;
			uniform float u_layer_3_curve;
			uniform bool u_loop_1_running;
			uniform bool u_loop_2_running;
			uniform bool u_layer_1_running;
			uniform bool u_layer_2_running;


			vec3 screen (vec3 target, vec3 blend){
				return 1.0 - (1.0 - target) * (1.0 - blend);
			}

			vec3 overlay (vec3 target, vec3 blend){
				vec3 temp;
				temp.x = (target.x > 0.5) ? (1.0-(1.0-2.0*(target.x-0.5))*(1.0-blend.x)) : (2.0*target.x)*blend.x;
				temp.y = (target.y > 0.5) ? (1.0-(1.0-2.0*(target.y-0.5))*(1.0-blend.y)) : (2.0*target.y)*blend.y;
				temp.z = (target.z > 0.5) ? (1.0-(1.0-2.0*(target.z-0.5))*(1.0-blend.z)) : (2.0*target.z)*blend.z;
				return temp;
		}

			void main() {
				float amplitude = 100.;
				float frequency = 5.0;

				vec2 st = gl_FragCoord.st/u_resolution.xy;
				vec3 pattern_1 = vec3(0.6);
				vec3 pattern_2 = vec3(0.6);
				vec3 pattern_3 = vec3(0.6);
				vec3 rothko_1 = vec3(0.6);
				vec3 rothko_2	 = vec3(0.6);

				vec4 texture_1 = texture2D(u_texture_1, st);
				vec4 texture_2 = texture2D(u_texture_2, st);
				vec4 texture_3 = texture2D(u_texture_3, st);
				vec4 texture_4 = texture2D(u_texture_4, st);
				vec4 texture_5 = texture2D(u_texture_5, st);

				pattern_1 += texture_1.xyz;
				pattern_2 += texture_2.xyz;
				pattern_3 += texture_5.xyz;
				rothko_1 += texture_3.xyz;
				rothko_2 += texture_4.xyz;

				vec3 print = vec3(0.6);
				vec3 layer_1 = abs(pattern_1 - rothko_1 - pattern_2);
				vec3 layer_2 = abs(pattern_2 - rothko_2);
				vec3 layer_3 = abs(pattern_3 - rothko_1);


				if(u_loop_1_running) {

				if( all(greaterThan(layer_1, vec3(u_layer_1_curve)))) {
						layer_1 = vec3(0.08);
					} else {
						layer_1 = vec3(0.6);
					}


				if( all(greaterThan(layer_2, vec3(u_layer_2_curve)))) {
						layer_2 = vec3(0.08);
					} else {
						layer_2 = vec3(0.6);
					}
//
//
		//		if( all(greaterThan(layer_3, vec3(u_layer_3_curve)))) {
		//				layer_3 = vec3(0.08);
		//			} else {
		//				layer_3 = vec3(0.6);
		//			}
				}

				print = screen(layer_1, layer_2);


				if( all(greaterThan(print, vec3(u_loop_1)))) {
					print = vec3(0.08);
				} else {
					print = vec3(0.6);
				}

				vec4 texture = vec4(print, 1.0);

				gl_FragColor = texture;
			}
		</script>
    <script>
			console.log('%c ⒷⒷ', 'font-size: 42px');
			console.log('%c ⒹⒹⒹ', 'font-size: 42px');

			document.onreadystatechange = () => {
				if (document.readyState === 'complete') {
					document.querySelector('#container').classList.remove('hide');
				}
			};

			let container;
			let canvas;
			let camera, scene, renderer;
			let uniforms;
			let loop_1 = 0.0;
			let loop_2 = 0.0;
			let loop_1_running = true;
			let loop_2_running = false;
			let layer_1_running = false;
			let layer_2_running = false;
			let layer_1_tick = 0;
			let layer_2_tick = 0;
			let layer_3_tick = 0;
			let layer_1_curve = 0;
			let layer_2_curve = 0;
			let layer_3_curve = 0;


			const layer1 = new Image();
			const layer2 = new Image();
			const layer3 = new Image();

			init();
			animate();

			function init() {
				renderer = new THREE.WebGLRenderer();
				renderer.setClearColor(1.0, 1.0, 1.0, 0.0);
				renderer.setPixelRatio( window.devicePixelRatio );

				container = document.getElementById( 'container' );
				container.appendChild( renderer.domElement );

				camera = new THREE.Camera();
				camera.position.z = 1;

				scene = new THREE.Scene();

				const geometry = new THREE.PlaneBufferGeometry( 2, 2 );
				const ctx_1 = document.querySelector('#layer1').getContext('2d');
				const ctx_2 = document.querySelector('#layer2').getContext('2d');
				const ctx_3 = document.querySelector('#layer3').getContext('2d');
				const canvas_1 = ctx_1.canvas;
				const canvas_2 = ctx_2.canvas;
				const canvas_3 = ctx_3.canvas;

				const isSmallScreen = window.screen.width < 400;
				canvas_1.width = isSmallScreen ? window.screen.width : window.innerWidth;
				canvas_1.height = isSmallScreen ? window.screen.height : window.innerHeight;
				canvas_2.width = isSmallScreen ? window.screen.width : window.innerWidth;
				canvas_2.height = isSmallScreen ? window.screen.height : window.innerHeight;
				canvas_3.width = isSmallScreen ? window.screen.width : window.innerWidth;
				canvas_3.height = isSmallScreen ? window.screen.height : window.innerHeight;

				function isPortrait() {
					const ratio = window.innerWidth / window.innerHeight;
					return ratio >= 1 ? false : true;
				}

				function setSource() {
					ctx_1.clearRect(0, 0, canvas_1.width, canvas_1.height);
					ctx_2.clearRect(0, 0, canvas_2.width, canvas_2.height);
					ctx_3.clearRect(0, 0, canvas_3.width, canvas_3.height);

					layer1.src = isPortrait() ? "img/intro_portrait.png" : "img/intro.png";
					layer2.src = isPortrait() ? "img/quote_portrait.png" : "img/quote.png";
					layer3.src = isPortrait() ? "img/lineup_portrait.png" : "img/lineup.png";
				}
				setSource();

				function updateCanvas() {
					setSource();
					canvasTexture_1.needsUpdate = true;
					canvasTexture_2.needsUpdate = true;
				}

				function scaleToFit(img, context){
					const canvas = context.canvas;
					const scale = Math.min(canvas.width / img.width, canvas.height / img.height);
					const x = (canvas.width / 2) - (img.width / 2) * scale;
					const y = (canvas.height / 2) - (img.height / 2) * scale;
					return context.drawImage(img, x, y, img.width * scale, img.height * scale);
				}

				function drawImage(img, context, texture) {
					context.fillRect(0, 0, context.canvas.width, context.canvas.height);
					scaleToFit(img, context);
					texture.needsUpdate = true;
				}

				layer1.onload = () => drawImage(layer1, ctx_1, canvasTexture_1);
				layer2.onload = () => drawImage(layer2, ctx_2, canvasTexture_2);
				layer3.onload = () => drawImage(layer3, ctx_3, canvasTexture_3);

				window.addEventListener('resize', updateCanvas, false);

				const canvasTexture_1 = new THREE.CanvasTexture(ctx_1.canvas);
				const canvasTexture_2 = new THREE.CanvasTexture(ctx_2.canvas);
				const canvasTexture_3 = new THREE.CanvasTexture(ctx_3.canvas);

				const loader = new THREE.TextureLoader();

				const texture1 = canvasTexture_1;
				const texture2 = canvasTexture_2;
				const texture5 = canvasTexture_3;

				const rothko1 = isPortrait() ? './img/rothko1_portrait.jpg' : './img/rothko1.jpg';
				const rothko2 = isPortrait() ? './img/rothko2_portrait.jpg' : './img/rothko2.jpg';
				const texture3 = loader.load( rothko1 );
				const texture4 = loader.load( rothko2 );

				texture1.minFilter = THREE.LinearFilter;
				texture2.minFilter = THREE.LinearFilter;
				texture3.minFilter = THREE.LinearFilter;
				texture4.minFilter = THREE.LinearFilter;
				texture5.minFilter = THREE.LinearFilter;

				uniforms = {
					u_loop_1: { type: "f", value: 1.0 },
					u_loop_2: { type: "f", value: 1.0 },
					u_layer_1_curve: { type: "f", value: 1.0 },
					u_layer_2_curve: { type: "f", value: 1.0 },
					u_layer_3_curve: { type: "f", value: 1.0 },
					u_loop_1_running: { type: "b", value: false },
					u_loop_2_running: { type: "b", value: false },
					u_layer_1_running: { type: "b", value: false },
					u_layer_2_running: { type: "b", value: false },
					u_resolution: { type: "v2", value: new THREE.Vector2() },
					u_texture_1: { type: "t", value: texture1 },
					u_texture_2: { type: "t", value: texture2 },
					u_texture_3: { type: "t", value: texture3 },
					u_texture_4: { type: "t", value: texture4 },
					u_texture_5: { type: "t", value: texture5 },
				};

				const material = new THREE.ShaderMaterial({
					uniforms: uniforms,
					vertexShader: document.getElementById( 'vertexShader' ).textContent,
					fragmentShader: document.getElementById( 'fragmentShader' ).textContent,
					transparent: true,
					opacity: 0,
				});

				const mesh = new THREE.Mesh(geometry, material);

				scene.add(mesh);

				onWindowResize();
				window.addEventListener('resize', onWindowResize, false);
			}

			function onWindowResize(event) {
				renderer.setSize(window.innerWidth, window.innerHeight);
				camera.aspect = renderer.domElement.width / renderer.domElement.width;
				uniforms.u_resolution.value.x = renderer.domElement.width;
				uniforms.u_resolution.value.y = renderer.domElement.height;
			}

			function animate() {
				requestAnimationFrame(animate);
				render();
			}

			function render() {
				loop_1_running && (loop_1 += 0.01);
				loop_2_running && (loop_2 += 0.01);

				loop_length = 10;
				layer_count = 2;
				layer_length = loop_length / layer_count;

				const shortVelocity = .1;

					loop_1_curve = Math.sin(loop_1 * shortVelocity);
					loop_2_curve = Math.sin(loop_2 * shortVelocity);

				if (loop_1_running) {
						layer_1_running = true;
						layer_1_tick += 0.01;
						layer_1_curve = Math.sin(layer_1_tick * shortVelocity);

					if(loop_1 >= layer_length) {
						layer_2_running = true;
						layer_2_tick += 0.01;
						layer_2_curve = Math.sin(layer_2_tick * shortVelocity);
					}
					if(loop_1 >= layer_length * 2) {
						layer_2_tick += 0.01;
						layer_2_curve = Math.sin(layer_2_tick * shortVelocity);
					}
					if(loop_1 >= loop_length) {
						loop_1 = 0;
					}
				}

				console.log(layer_1_curve,layer_2_curve,layer_3_curve,)

				if (loop_2_running) {
					if ( loop_2_curve > 0.95) {
						loop_2_running = false;
						loop_2 = 0;
						loop_1_running = true;
					}
				}

				shortLoop_1 = Math.abs(loop_1_curve, 0);
				shortLoop_2 = Math.abs(loop_2_curve, 0);

				uniforms.u_loop_1.value = shortLoop_1;
				uniforms.u_loop_2.value = shortLoop_2;
				uniforms.u_layer_1_curve.value = layer_1_curve;
				uniforms.u_layer_2_curve.value = layer_2_curve;
				uniforms.u_layer_3_curve.value = layer_3_curve;
				uniforms.u_loop_1_running.value = loop_1_running;
				uniforms.u_loop_2_running.value = loop_2_running;
				uniforms.u_layer_1_running.value = layer_1_running;
				uniforms.u_layer_2_running.value = layer_2_running;

				renderer.render( scene, camera );
			}
		</script>
	</body>
</html>
